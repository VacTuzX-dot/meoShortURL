<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MEO Short URL</title>
    <link rel="icon" type="image/x-icon" href="/njz.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        color-scheme: dark;
      }
      body {
        font-family: "Space Grotesk", "SF Pro Display", "Soehne", system-ui,
          -apple-system, sans-serif;
        background: radial-gradient(circle at 18% 20%, #0f0f0f, #060606 48%),
          radial-gradient(circle at 85% 0%, #111111, transparent 40%),
          #050505;
      }
      .grid-lines {
        background-image: linear-gradient(
            to right,
            rgba(255, 255, 255, 0.055) 1px,
            transparent 1px
          ),
          linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.055) 1px,
            transparent 1px
          );
        background-size: 38px 38px;
        mask-image: radial-gradient(
          circle at center,
          rgba(0, 0, 0, 0.35) 40%,
          transparent 80%
        );
        -webkit-mask-image: radial-gradient(
          circle at center,
          rgba(0, 0, 0, 0.35) 40%,
          transparent 80%
        );
        opacity: 0.65;
      }
      .fade-in {
        animation: fadeIn 0.28s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .float-slow {
        animation: float 9s ease-in-out infinite alternate;
      }
      .float-slower {
        animation: float 12s ease-in-out infinite alternate;
      }
      @keyframes float {
        from {
          transform: translateY(0px) translateX(0);
        }
        to {
          transform: translateY(-12px) translateX(8px);
        }
      }
      .input-shell {
        transition: border-color 0.2s ease, box-shadow 0.2s ease,
          transform 0.15s ease, background-color 0.2s ease;
      }
      .input-shell:focus-within {
        border-color: rgba(255, 255, 255, 0.65);
        box-shadow: 0 18px 50px -36px rgba(255, 255, 255, 0.35);
        transform: translateY(-1px);
        background-color: rgba(255, 255, 255, 0.08);
      }
      @media (prefers-reduced-motion: reduce) {
        .fade-in,
        .float-slow,
        .float-slower {
          animation: none;
        }
      }
    </style>
  </head>
  <body
    class="text-slate-50 min-h-screen relative antialiased selection:bg-white/10 selection:text-white"
  >
    <div class="pointer-events-none absolute inset-0 overflow-hidden">
      <div class="grid-lines absolute inset-0 opacity-70" aria-hidden="true"></div>
      <div
        class="absolute -left-28 top-10 h-64 w-64 bg-white/5 blur-3xl float-slow"
        aria-hidden="true"
      ></div>
      <div
        class="absolute right-0 bottom-10 h-72 w-72 bg-white/10 blur-3xl float-slower"
        aria-hidden="true"
      ></div>
    </div>

    <header class="relative z-10 px-5 sm:px-8 pt-10 pb-6 max-w-6xl mx-auto">
      <div class="flex flex-wrap items-center gap-3 justify-between">
        <div class="flex items-center gap-3">
          <div
            class="h-9 w-9 rounded-full border border-white/20 bg-white/10 shadow-sm shadow-white/10 grid place-items-center text-xs font-semibold uppercase tracking-[0.18em] text-white"
          >
            M
          </div>
          <div>
            <p class="text-xs uppercase tracking-[0.28em] text-slate-400">
              MEO Short
            </p>
            <h1 class="text-2xl sm:text-3xl font-semibold text-white">
              Minimal link studio
            </h1>
          </div>
        </div>
        <div class="flex items-center gap-2 text-xs text-slate-200">
          <span class="rounded-full border border-white/20 px-3 py-1 bg-white/5">
            No login
          </span>
          <span class="rounded-full border border-white/20 px-3 py-1 bg-white/5">
            HTTPS ready
          </span>
        </div>
      </div>
    </header>

    <main class="relative z-10 px-5 sm:px-8 pb-12 max-w-6xl mx-auto">
      <div class="rounded-3xl border border-white/10 bg-black/40 shadow-[0_20px_80px_rgba(0,0,0,0.55)] backdrop-blur">
        <div class="grid gap-10 lg:grid-cols-[1.05fr,0.95fr] p-6 sm:p-10">
          <section class="space-y-8">
            <div class="space-y-3">
              <p class="text-xs uppercase tracking-[0.3em] text-slate-400">
                Start here
              </p>
              <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
                <div class="space-y-2">
                  <h2 class="text-3xl sm:text-4xl font-semibold leading-tight text-white">
                    Short links, no noise.
                  </h2>
                  <p class="text-sm text-slate-300 max-w-xl">
                    วางปลายทาง เลือก slug ขาวดำเรียบง่าย กดครั้งเดียวได้ลิงก์พร้อมแชร์
                    รองรับมือถือ แท็บเล็ต และเดสก์ท็อป.
                  </p>
                </div>
                <div class="inline-flex items-center gap-2 text-xs text-slate-200">
                  <span class="h-2 w-2 rounded-full bg-white"></span>
                  <span class="text-white">live redirect</span>
                </div>
              </div>
            </div>

            <form id="shortenForm" class="space-y-6">
              <div class="space-y-2">
                <label class="text-xs uppercase tracking-[0.2em] text-slate-400"
                  >Destination URL</label
                >
                <div
                  class="input-shell rounded-2xl border border-white/15 bg-white/5"
                >
                  <input
                    type="url"
                    id="urlInput"
                    required
                    placeholder="https://example.com/very/long/link"
                    class="w-full bg-transparent px-4 py-3.5 outline-none text-sm sm:text-base text-slate-50 placeholder:text-slate-500"
                    autocomplete="off"
                  />
                </div>
                <p class="text-xs text-slate-400">
                  ใช้ https:// หรือ http:// เพื่อให้ redirect ปลอดภัย
                </p>
              </div>

              <div class="space-y-2">
                <label class="text-xs uppercase tracking-[0.2em] text-slate-400"
                  >Custom slug (optional)</label
                >
                <div
                  class="input-shell flex items-center rounded-2xl border border-white/15 bg-white/5 overflow-hidden"
                >
                  <span
                    id="slugPrefix"
                    class="px-4 text-sm sm:text-base text-slate-300 border-r border-white/10 whitespace-nowrap bg-white/5"
                  ></span>
                  <input
                    type="text"
                    id="slugInput"
                    placeholder="my-link"
                    class="w-full bg-transparent px-3 sm:px-4 py-3.5 outline-none text-sm sm:text-base text-slate-50 placeholder:text-slate-500"
                    autocomplete="off"
                  />
                </div>
                <p class="text-xs text-slate-400">
                  ตัวอักษร a-z 0-9 - _ เท่านั้น (เว้นว่างให้ระบบสุ่ม)
                </p>
              </div>

              <button
                id="submitBtn"
                type="submit"
                class="group w-full inline-flex items-center justify-center gap-3 rounded-2xl bg-white/10 text-white font-semibold py-3.5 shadow-lg shadow-white/10 border border-white/15 hover:-translate-y-[1px] active:translate-y-[0.5px] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/30"
              >
                <span
                  id="loadingIcon"
                  class="hidden h-4 w-4 rounded-full border-2 border-white/40 border-l-white animate-spin"
                ></span>
                <span id="submitText">Create short link</span>
                <span
                  class="text-lg leading-none translate-y-[1px] group-hover:translate-x-0.5 transition-transform"
                  aria-hidden="true"
                  >→</span
                >
              </button>
            </form>

            <div
              id="resultArea"
              class="hidden rounded-2xl border border-white/15 bg-white/5 p-5 sm:p-6 fade-in"
            >
              <p class="text-xs uppercase tracking-[0.24em] text-slate-400 mb-2">
                Ready to share
              </p>
              <div
                class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"
              >
                <a
                  id="shortLink"
                  href="#"
                  target="_blank"
                  rel="noopener"
                  class="text-lg font-semibold text-white break-all hover:underline underline-offset-4"
                ></a>
                <button
                  id="copyBtn"
                  type="button"
                  class="inline-flex items-center gap-2 rounded-xl border border-white/20 bg-white/5 px-3.5 py-2.5 text-sm text-slate-100 hover:border-white/40 transition-colors"
                >
                  <span>Copy</span>
                </button>
              </div>
              <p
                id="destinationPreview"
                class="text-xs text-slate-400 mt-2"
              ></p>
            </div>

            <p id="errorMsg" class="hidden text-rose-300 text-sm"></p>
          </section>

          <aside
            class="rounded-2xl border border-white/12 bg-white/5 p-5 sm:p-6 space-y-6 shadow-inner shadow-white/10"
          >
            <div class="flex items-center justify-between">
              <span class="text-sm font-medium text-white">Flow</span>
              <span
                class="text-[11px] rounded-full border border-white/20 px-3 py-1 text-slate-200 bg-white/5"
                >15s setup</span
              >
            </div>
            <ul class="space-y-4 text-sm text-slate-200">
              <li class="flex items-start gap-3">
                <span class="mt-1 h-2 w-2 rounded-full bg-white"></span>
                <span>วาง URL ปลายทาง ระบบตรวจ protocol ให้เรียบร้อย</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="mt-1 h-2 w-2 rounded-full bg-white"></span>
                <span>ใส่ slug เองหรือปล่อยให้สุ่มแบบมินิมอล</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="mt-1 h-2 w-2 rounded-full bg-white"></span>
                <span>กดสร้าง คัดลอกลิงก์ แชร์ได้เลย รองรับทุกอุปกรณ์</span>
              </li>
            </ul>
            <div
              class="rounded-xl border border-white/12 bg-white/5 p-4 space-y-2"
            >
              <p class="text-xs uppercase tracking-[0.18em] text-slate-400">
                Minimal tips
              </p>
              <p class="text-sm text-slate-200">
                ใช้ slug สั้น จำง่าย วางเป็นคิวอาร์หรือส่งข้อความก็อ่านง่ายในธีมขาวดำ.
              </p>
            </div>
            <div class="grid gap-3 sm:grid-cols-3 text-xs text-slate-300">
              <div class="flex flex-col gap-1 rounded-lg border border-white/10 bg-white/5 p-3">
                <span class="text-[10px] uppercase tracking-[0.18em] text-slate-400">Speed</span>
                <span class="text-base font-semibold text-white">Instant</span>
                <span class="text-[11px] text-slate-400">สร้างลิงก์รวดเดียว</span>
              </div>
              <div class="flex flex-col gap-1 rounded-lg border border-white/10 bg-white/5 p-3">
                <span class="text-[10px] uppercase tracking-[0.18em] text-slate-400">Privacy</span>
                <span class="text-base font-semibold text-white">No login</span>
                <span class="text-[11px] text-slate-400">ไม่มีโฆษณา</span>
              </div>
              <div class="flex flex-col gap-1 rounded-lg border border-white/10 bg-white/5 p-3">
                <span class="text-[10px] uppercase tracking-[0.18em] text-slate-400">Clicks</span>
                <span class="text-base font-semibold text-white">Tracked</span>
                <span class="text-[11px] text-slate-400">นับยอดฝั่งเซิร์ฟเวอร์</span>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </main>

    <script>
      const form = document.getElementById("shortenForm");
      const urlInput = document.getElementById("urlInput");
      const slugInput = document.getElementById("slugInput");
      const slugPrefix = document.getElementById("slugPrefix");
      const resultArea = document.getElementById("resultArea");
      const shortLink = document.getElementById("shortLink");
      const destinationPreview = document.getElementById("destinationPreview");
      const errorMsg = document.getElementById("errorMsg");
      const copyBtn = document.getElementById("copyBtn");
      const submitBtn = document.getElementById("submitBtn");
      const submitText = document.getElementById("submitText");
      const loadingIcon = document.getElementById("loadingIcon");

      const originHost = window.location.origin.replace(/\/$/, "");
      slugPrefix.textContent = originHost + "/";

      const setLoading = (isLoading) => {
        submitBtn.disabled = isLoading;
        submitBtn.classList.toggle("opacity-80", isLoading);
        loadingIcon.classList.toggle("hidden", !isLoading);
        submitText.textContent = isLoading ? "Working..." : "Create short link";
      };

      const showError = (message) => {
        errorMsg.textContent = message;
        errorMsg.classList.remove("hidden");
        resultArea.classList.add("hidden");
      };

      const clearFeedback = () => {
        errorMsg.classList.add("hidden");
        errorMsg.textContent = "";
        resultArea.classList.add("hidden");
      };

      const showResult = (shortUrl, originalUrl) => {
        shortLink.href = shortUrl;
        shortLink.textContent = shortUrl;
        destinationPreview.textContent = `Forwarding to ${originalUrl}`;
        resultArea.classList.remove("hidden");
        resultArea.classList.add("fade-in");
      };

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        clearFeedback();

        const url = urlInput.value.trim();
        const customSlug = slugInput.value.trim();

        if (!url) {
          showError("กรุณาใส่ URL ที่ต้องการย่อ");
          return;
        }

        try {
          new URL(url);
        } catch {
          showError("URL ไม่ถูกต้อง (ต้องขึ้นต้นด้วย http หรือ https)");
          return;
        }

        if (customSlug && !/^[a-zA-Z0-9-_]{2,50}$/.test(customSlug)) {
          showError("Slug ใช้ได้เฉพาะ a-z, 0-9, -, _ (2-50 ตัว)");
          return;
        }

        setLoading(true);

        try {
          const res = await fetch("/shorten", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              url,
              customSlug: customSlug || undefined,
            }),
          });

          const text = await res.text();
          if (!text) throw new Error("Server returned empty response");

          let data;
          try {
            data = JSON.parse(text);
          } catch {
            throw new Error(`Server Error: ${text}`);
          }

          if (!res.ok || !data.short_url) {
            throw new Error(data.error || "ไม่สามารถสร้างลิงก์ได้");
          }

          showResult(data.short_url, data.original_url || url);
        } catch (err) {
          console.error(err);
          showError(err?.message || "ไม่สามารถสร้างลิงก์ได้");
        } finally {
          setLoading(false);
        }
      });

      const copyToClipboard = async () => {
        const value = shortLink.textContent;
        if (!value) return;

        try {
          await navigator.clipboard.writeText(value);
          copyBtn.classList.add(
            "border-white",
            "text-white",
            "bg-white/20"
          );
          copyBtn.firstElementChild.textContent = "Copied";
          setTimeout(() => {
            copyBtn.classList.remove(
              "border-white",
              "text-white",
              "bg-white/20"
            );
            copyBtn.firstElementChild.textContent = "Copy";
          }, 1200);
        } catch (err) {
          console.error(err);
          showError("ไม่สามารถคัดลอกได้ กรุณาคัดลอกเอง");
        }
      };

      copyBtn.addEventListener("click", copyToClipboard);
    </script>
  </body>
</html>
